<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è“‰å®çš„å›½å­¦ä¹¦é™¢ - å°Šäº«ç®¡ç†ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-gradient: #fcf9f2; 
            --sidebar-bg: #2c3e50; 
            --content-bg: #fffbf0; 
            --primary: #b83b3b; 
            --accent: #f1c40f;
            --text-dark: #2b2b2b;
            --text-light: #ecf0f1;
            --line-color: rgba(184, 59, 59, 0.08);
            --radius: 8px;
        }

        * { box-sizing: border-box; }
        
        body {
            font-family: "Comic Sans MS", "Chalkboard SE", "Kaiti", "STKaiti", "æ¥·ä½“", serif;
            background-color: #f0ebe0;
            background-image: linear-gradient(to right, rgba(0,0,0,0.02) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(0,0,0,0.02) 1px, transparent 1px);
            background-size: 20px 20px;
            margin: 0; padding: 0;
            height: 100vh;
            display: flex; justify-content: center; align-items: center;
            color: var(--text-dark); overflow: hidden;
        }

        .app-container {
            width: 1200px; height: 92vh; background: var(--content-bg);
            border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border: 1px solid #cbbba0; display: flex; overflow: hidden; position: relative;
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 260px; background: var(--sidebar-bg); padding: 30px 15px;
            display: flex; flex-direction: column; color: var(--text-light); z-index: 2;
        }
        .profile-card { text-align: center; margin-bottom: 20px; flex-shrink: 0; }
        .avatar {
            width: 90px; height: 90px; background: #fff; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 50px; margin: 0 auto 15px; border: 4px solid var(--primary);
        }
        .stats-row {
            display: flex; justify-content: space-around; margin-top: 15px;
            background: rgba(255,255,255,0.1); padding: 10px; border-radius: 6px; font-size: 13px; color: #bdc3c7;
        }
        .nav-menu { list-style: none; padding: 0; flex: 1; overflow-y: auto; margin-right: -5px; padding-right: 5px; }
        .nav-menu::-webkit-scrollbar { width: 4px; }
        .nav-menu::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 4px; }
        .nav-item {
            display: flex; align-items: center; gap: 15px; padding: 12px 15px; margin-bottom: 8px;
            border-radius: 6px; cursor: pointer; transition: all 0.3s ease; color: rgba(255,255,255,0.7);
            font-size: 1.1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .nav-item:hover { background: rgba(255,255,255,0.1); color: white; transform: translateX(5px); }
        .nav-item.active { background: var(--primary); color: white; font-weight: bold; transform: translateX(3px); }

        /* å­¦æœŸè¿›åº¦ */
        .semester-box { margin-top: 20px; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; }
        .semester-label { font-size: 12px; color: #bdc3c7; margin-bottom: 5px; display: flex; justify-content: space-between;}
        .semester-bar-bg { height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; }
        .semester-bar-fill { height: 100%; background: linear-gradient(90deg, #f1c40f, #e67e22); width: 0%; border-radius: 4px; }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1; background: var(--content-bg); padding: 0; 
            overflow-y: hidden; display: flex; flex-direction: column; position: relative;
        }
        .top-quote-banner {
            background: linear-gradient(to right, #f7f2e6, #fffbf0);
            padding: 20px 40px; border-bottom: 1px solid #e0dace;
            text-align: center; position: relative; flex-shrink: 0; min-height: 90px;
            display: flex; flex-direction: column; justify-content: center;
        }
        .quote-text {
            font-size: 1.6rem; color: var(--primary); font-weight: bold; font-family: "Kaiti", serif;
            margin-bottom: 5px; text-shadow: 1px 1px 0 rgba(0,0,0,0.05); animation: fadeIn 1.5s ease-in-out;
        }
        .quote-author { font-size: 0.9rem; color: #7f8c8d; font-family: "Kaiti", serif; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .scroll-area { flex: 1; overflow-y: auto; padding: 30px 40px; }
        .scroll-area::-webkit-scrollbar { width: 8px; }
        .scroll-area::-webkit-scrollbar-thumb { background: #dcd6c8; border-radius: 4px; }

        /* é€šç”¨ç»„ä»¶ */
        .page-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid var(--primary);
        }
        .page-title { font-size: 26px; font-weight: bold; color: var(--text-dark); letter-spacing: 2px; }
        .card {
            background: #fff; border-radius: var(--radius); padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #e0dace;
            position: relative;
        }
        .en-font { font-family: "Comic Sans MS", "Chalkboard SE", sans-serif; font-weight: bold; }
        .btn-primary {
            background: var(--primary); color: white; border: none; padding: 8px 20px;
            border-radius: 4px; cursor: pointer; font-family: "Kaiti"; font-weight: bold; font-size: 1rem;
        }

        /* æˆç»©å¡ç‰‡ */
        .subject-stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: #fdfbf7; padding: 15px; border: 1px solid #eee; border-radius: 8px; text-align: center; }
        .stat-score { font-size: 1.8rem; font-weight: bold; font-family: "Comic Sans MS"; margin-bottom: 5px; }
        .stat-trend { font-size: 0.8rem; padding: 2px 8px; border-radius: 10px; display: inline-block; }
        .trend-up { background: #ffebeb; color: #b83b3b; }
        .trend-down { background: #e8f5e9; color: #27ae60; }

        /* çŸ¥è¯†æ ‘ */
        .knowledge-progress { background: #eee; height: 10px; border-radius: 5px; margin-bottom: 20px; overflow: hidden; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #f1c40f, #e67e22); width: 0%; transition: width 0.5s; }
        .k-item { display: flex; justify-content: space-between; padding: 12px 10px; border-bottom: 1px dashed #eee; font-size: 0.95rem; cursor: pointer; transition: 0.2s; align-items: center; }
        .k-item:hover { background: #f9f9f9; }
        .k-item.completed { color: #aaa; }
        .k-item.completed span:first-child { text-decoration: line-through; }
        .k-item.completed span:last-child { color: var(--primary); font-weight: bold; }

        /* ä¹ æƒ¯æ‰“å¡ */
        .habit-stats-panel { 
            background: linear-gradient(135deg, #2c3e50, #34495e); color: white; 
            padding: 20px; border-radius: 8px; margin-bottom: 20px; display: flex; justify-content: space-around; 
        }
        .hs-num { font-size: 1.8rem; font-weight: bold; font-family: "Comic Sans MS"; color: var(--accent); }
        .habit-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 15px; border: 1px solid #eee; border-radius: 8px; margin-bottom: 10px; cursor: pointer; background: #fff; transition: 0.2s;
        }
        .habit-item.done { background: #fff5f5; border-color: var(--primary); }
        .habit-check { width: 26px; height: 26px; border: 2px solid #ddd; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px;}
        .habit-item.done .habit-check { background: var(--primary); border-color: var(--primary); color: white; }

        /* å¥–åŠ±ç½‘æ ¼ */
        .reward-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .reward-card { text-align: center; padding: 20px; border: 1px solid #eee; border-radius: 8px; cursor: pointer; transition: 0.2s; position: relative;}
        .reward-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-color: var(--accent); }
        .reward-icon { font-size: 2.5rem; margin-bottom: 10px; }

        /* --- å¤«å­åå°åŠ å¼ºç‰ˆæ ·å¼ --- */
        .admin-section { margin-bottom: 30px; border: 1px solid #eee; border-radius: 8px; overflow: hidden; }
        .admin-header { background: #fdfbf7; padding: 10px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: bold; color: #2c3e50; }
        .admin-header:hover { background: #f2f0eb; }
        .admin-body { padding: 20px; display: none; background: #fff; }
        .admin-section.open .admin-body { display: block; }
        .admin-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
        .admin-table th, .admin-table td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        .admin-table input { width: 100%; border: none; text-align: center; font-family: inherit; background: transparent; }
        .btn-del { background: #ff7675; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .btn-add { background: #27ae60; color: white; border: none; padding: 5px 15px; border-radius: 4px; cursor: pointer; margin-top: 10px; }

        /* å…¶ä»– */
        .sch-table { width: 100%; border-collapse: collapse; }
        .sch-table th { color: var(--primary); font-size: 14px; padding: 10px; border-bottom: 2px solid #eee; }
        .sch-table td { padding: 12px; text-align: center; border-bottom: 1px solid #eee; color: #555; }
        .today-col { background: #fdf2f2 !important; color: var(--primary) !important; font-weight: bold; }
        .note-textarea {
            width: 100%; height: 160px; padding: 10px 15px; font-family: "Kaiti"; font-size: 1.25rem;
            background: #fdfbf7 linear-gradient(transparent 95%, var(--line-color) 95%); background-size: 100% 2.4rem; line-height: 2.4rem;
            border: 1px solid #dcd6c8; border-radius: 8px; resize: none; outline: none;
        }
        .admin-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px; }

        /* é¡µé¢æ˜¾ç¤º */
        .page { display: none; opacity: 0; transition: opacity 0.4s; }
        .page.active { display: block; opacity: 1; }
    </style>
</head>
<body>

<div class="app-container">
    <aside class="sidebar">
        <div class="profile-card">
            <div class="avatar">ğŸ¼</div>
            <h2 style="margin:0; font-size:22px;">è“‰å®åŒå­¦</h2>
            <div style="font-size:12px; opacity:0.7;">ä¸‰å¹´çº§ Â· å‹¤å‹‰ä¹¦ç«¥</div>
            <div class="stats-row">
                <div><div style="font-weight:bold; font-size:16px;" id="stat-days">1</div><div>ä¿®ä¹ å¤©æ•°</div></div>
                <div style="width:1px; background:rgba(255,255,255,0.2);"></div>
                <div><div style="font-weight:bold; font-size:16px;" id="stat-points">0</div><div>æˆå°±ç‚¹</div></div>
            </div>
        </div>

        <ul class="nav-menu">
            <li class="nav-item active" onclick="switchPage('schedule', this)"><span>ğŸ“…</span> è¯¾è¡¨ Â· æ—¥è¯¾</li>
            <li class="nav-item" onclick="switchPage('grades', this)"><span>ğŸ“Š</span> æˆç»© Â· ç»Ÿè®¡</li>
            <li class="nav-item" onclick="switchPage('timer', this)"><span>â³</span> ä¸“æ³¨ Â· æ²™æ¼</li>
            <li class="nav-item" onclick="switchPage('knowledge', this)"><span>ğŸ“œ</span> è—ä¹¦ Â· çŸ¥è¯†</li>
            <li class="nav-item" onclick="switchPage('habits', this)"><span>âœï¸</span> ä¿®èº« Â· ä¹ æƒ¯</li>
            <li class="nav-item" onclick="switchPage('rewards', this)"><span>ğŸ</span> çŠ’èµ Â· å…‘æ¢</li>
            <li class="nav-item" onclick="checkAdmin()" style="margin-top: 20px; color: #95a5a6; border-top: 1px solid rgba(255,255,255,0.1); padding-top:20px;"><span>ğŸ”’</span> å¤«å­åå°</li>
        </ul>

        <div class="semester-box">
            <div class="semester-label"><span>å…‰é˜´ä¼¼ç®­</span><span id="semester-percent">0%</span></div>
            <div class="semester-bar-bg"><div id="semester-bar" class="semester-bar-fill"></div></div>
            <div style="font-size:10px; color:#95a5a6; margin-top:5px; text-align:right;">è·ç¦»æœŸæœ«è¿˜æœ‰ <span id="days-left" style="color:#f1c40f">0</span> å¤©</div>
        </div>
    </aside>

    <main class="main-content">
        <div class="top-quote-banner">
            <div id="daily-quote-text" class="quote-text">è½½å…¥ä¸­...</div>
            <div id="daily-quote-author" class="quote-author"></div>
        </div>

        <div class="scroll-area">
            
            <div id="page-schedule" class="page active">
                <div class="page-header">
                    <div class="page-title">æœ¬å‘¨æ—¥è¯¾</div>
                    <div style="color: #7f8c8d;" id="today-date" class="en-font">--</div>
                </div>
                <div style="display: grid; grid-template-columns: 2.5fr 1fr; gap: 20px;">
                    <div class="card">
                        <table class="sch-table" id="sch-table">
                            <thead><tr><th>æ—¶è¾°</th><th>å‘¨ä¸€</th><th>å‘¨äºŒ</th><th>å‘¨ä¸‰</th><th>å‘¨å››</th><th>å‘¨äº”</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div>
                        <div class="card" style="background:#2c3e50; color:white; border:none;">
                            <h3 style="margin-top:0;">ğŸ’ æ˜æ—¥ä¹¦ç®±</h3>
                            <div style="font-size:12px; opacity:0.8;">æ˜æ—¥ <span id="tomorrow-day" class="en-font" style="color:#f1c40f">--</span>ï¼Œè¯·å¤‡ï¼š</div>
                            <div id="pack-list" style="margin-top:10px;"></div>
                        </div>
                        <div class="card">
                            <h4 style="margin:0 0 10px 0; color:#555;">ğŸ“ è®°äº‹æ‰‹æœ­</h4>
                            <textarea class="note-textarea" placeholder="åœ¨æ­¤å¤„è®°å½•å¤«å­å¸ƒç½®çš„ä»»åŠ¡...&#10;ä¹¦å†™æ—¶è¯·å¹³å¿ƒé™æ°”ã€‚"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div id="page-grades" class="page">
                <div class="page-header">
                    <div class="page-title">å­¦ä¸šè€ƒè¯„</div>
                    <div style="font-size:14px; color:#666;">è¯­æ•°å¤– Â· è¿›é˜¶å›¾</div>
                </div>
                <div class="subject-stats-grid" id="subject-stats-cards"></div>
                <div class="card">
                    <h3 style="margin-top:0; color:#2c3e50;">ä¸‰ç§‘è¶‹åŠ¿å¯¹æ¯”</h3>
                    <div class="chart-container" style="height:300px; width:100%"><canvas id="scoreChart"></canvas></div>
                </div>
                <div class="card">
                    <h3 style="margin-top:0; color:#2c3e50;">è¯¦ç»†è®°å½•</h3>
                    <table class="sch-table" style="text-align:left;">
                        <thead><tr><th>æ—¥æœŸ</th><th>ç§‘ç›®</th><th>åˆ†æ•°</th><th>è¯„è¯­</th></tr></thead>
                        <tbody id="score-table-body"></tbody>
                    </table>
                </div>
            </div>

            <div id="page-timer" class="page">
                <div class="page-header"><div class="page-title">ä¸“æ³¨æ²™æ¼</div></div>
                <div class="card" style="text-align:center; padding:40px;">
                    <div style="font-size:60px;">â³</div>
                    <h2 style="margin:10px 0;">ä¸“æ³¨æ¨¡å¼</h2>
                    <div id="timer-display" style="font-size:4rem; color:var(--primary); margin:20px 0; font-family:'Comic Sans MS'">25:00</div>
                    <button class="btn-primary" onclick="startTimer(25)">25åˆ†é’Ÿ (ä½œä¸š)</button>
                    <button class="btn-primary" onclick="startTimer(10)">10åˆ†é’Ÿ (èƒŒè¯µ)</button>
                    <button style="border:1px solid #ccc; background:white; padding:8px 20px; border-radius:4px; margin-left:10px; cursor:pointer;" onclick="resetTimer()">é‡ç½®</button>
                </div>
            </div>

            <div id="page-knowledge" class="page">
                <div class="page-header">
                    <div class="page-title">è—ä¹¦é˜ Â· çŸ¥è¯†é€šå…³</div>
                    <div style="font-size:14px; color:#666;">äººæ•™ç‰ˆä¸‰å¹´çº§ä¸Šå†Œ</div>
                </div>
                <div style="margin-bottom:10px; font-size:14px;">æœ¬å­¦æœŸé€šå…³è¿›åº¦ï¼š<span id="k-progress-text">0%</span></div>
                <div class="knowledge-progress"><div id="k-progress-bar" class="progress-bar"></div></div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                    <div class="card" id="k-list-chinese"></div>
                    <div class="card" id="k-list-math"></div>
                    <div class="card" id="k-list-english"></div>
                </div>
            </div>

            <div id="page-habits" class="page">
                <div class="page-header">
                    <div class="page-title">æ¯æ—¥ä¿®èº«</div>
                    <div style="font-size:14px; color:#666;">ç‚¹å‡»æ‰“å¡ï¼Œå†æ¬¡ç‚¹å‡»å¯æ’¤é”€</div>
                </div>
                <div class="habit-stats-panel">
                    <div class="hs-item">
                        <div class="hs-num" id="habit-total-count">0</div>
                        <div style="font-size:12px;">æœ¬å­¦æœŸæ€»æ‰“å¡(æ¬¡)</div>
                    </div>
                    <div class="hs-item">
                        <div class="hs-num" id="habit-today-count">0</div>
                        <div style="font-size:12px;">ä»Šæ—¥å®Œæˆ</div>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div><h3 style="color:#27ae60;">ğŸ“š åŠå­¦ç¯‡ (å­¦ä¹ )</h3><div id="habit-list-study"></div></div>
                    <div><h3 style="color:#2980b9;">ğŸŒŸ å…»æ­£ç¯‡ (ç”Ÿæ´»)</h3><div id="habit-list-life"></div></div>
                </div>
            </div>

            <div id="page-rewards" class="page">
                <div class="page-header"><div class="page-title">çŠ’èµå…‘æ¢</div></div>
                <div class="reward-grid" id="reward-list"></div>
            </div>

            <div id="page-admin" class="page">
                <div class="page-header">
                    <div class="page-title">å¤«å­åå°</div>
                    <button onclick="logoutAdmin()" style="border:1px solid #ccc; background:white; cursor:pointer;">é€€å‡ºåå°</button>
                </div>

                <div class="admin-section open">
                    <div class="admin-header" onclick="toggleAdminSection(this)">ğŸ“ æˆç»©å½•å…¥</div>
                    <div class="admin-body">
                        <div style="display:flex; gap:10px; margin-bottom:10px;">
                            <input type="text" id="admin-date" class="admin-input" placeholder="æ—¥æœŸ (11-25)" style="margin:0">
                            <input type="number" id="admin-ch" class="admin-input" placeholder="è¯­æ–‡" style="margin:0">
                            <input type="number" id="admin-ma" class="admin-input" placeholder="æ•°å­¦" style="margin:0">
                            <input type="number" id="admin-en" class="admin-input" placeholder="è‹±è¯­" style="margin:0">
                        </div>
                        <input type="text" id="admin-comment" class="admin-input" placeholder="è¯„è¯­..." style="margin-bottom:10px;">
                        <button class="btn-primary" onclick="adminAddExam()">å½•å…¥è€ƒè¯„</button>
                    </div>
                </div>

                <div class="admin-section">
                    <div class="admin-header" onclick="toggleAdminSection(this)">ğŸ“… è¯¾è¡¨ç®¡ç†</div>
                    <div class="admin-body">
                        <table class="admin-table" id="admin-schedule-table">
                            <thead><tr><th>æ—¶é—´</th><th>å‘¨ä¸€</th><th>å‘¨äºŒ</th><th>å‘¨ä¸‰</th><th>å‘¨å››</th><th>å‘¨äº”</th></tr></thead>
                            <tbody></tbody>
                        </table>
                        <button class="btn-primary" onclick="saveScheduleAdmin()">ä¿å­˜è¯¾è¡¨</button>
                    </div>
                </div>

                <div class="admin-section">
                    <div class="admin-header" onclick="toggleAdminSection(this)">âœï¸ ä¿®èº«ä¹ æƒ¯è®¾ç½®</div>
                    <div class="admin-body">
                        <ul id="admin-habit-list" style="padding-left:20px;"></ul>
                        <div style="margin-top:10px; border-top:1px dashed #ccc; padding-top:10px;">
                            <input type="text" id="new-habit-txt" placeholder="æ–°ä¹ æƒ¯åç§°" style="padding:5px; width:200px;">
                            <select id="new-habit-type" style="padding:5px;"><option value="study">å­¦ä¹ ç±»</option><option value="life">ç”Ÿæ´»ç±»</option></select>
                            <button class="btn-add" onclick="addHabitAdmin()">æ·»åŠ </button>
                        </div>
                    </div>
                </div>

                <div class="admin-section">
                    <div class="admin-header" onclick="toggleAdminSection(this)">ğŸ å¥–åŠ±é¡¹ç›®è®¾ç½®</div>
                    <div class="admin-body">
                        <ul id="admin-reward-list" style="padding-left:20px;"></ul>
                        <div style="margin-top:10px; border-top:1px dashed #ccc; padding-top:10px;">
                            <input type="text" id="new-reward-name" placeholder="å¥–åŠ±åç§°" style="padding:5px; width:150px;">
                            <input type="number" id="new-reward-cost" placeholder="ç§¯åˆ†" style="padding:5px; width:80px;">
                            <input type="text" id="new-reward-icon" placeholder="å›¾æ ‡(å¦‚ğŸ“º)" style="padding:5px; width:80px;">
                            <button class="btn-add" onclick="addRewardAdmin()">æ·»åŠ </button>
                        </div>
                    </div>
                </div>
                
                <div style="text-align:right; margin-top:20px;">
                    <button onclick="if(confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ…é‡ï¼')){localStorage.clear();location.reload();}" style="color:red; background:none; border:none; cursor:pointer;">âš ï¸ æ¢å¤å‡ºå‚è®¾ç½®</button>
                </div>
            </div>
        </div>
    </main>
</div>

<script>
    // ================= é»˜è®¤æ•°æ® =================
    const DEFAULT_QUOTES = [
        {txt:"", auth:""}, 
        {txt:"ä¸ç§¯è·¬æ­¥ï¼Œæ— ä»¥è‡³åƒé‡Œã€‚", auth:"è€å­"}, {txt:"æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œå¯ä»¥ä¸ºå¸ˆçŸ£ã€‚", auth:"å­”å­"},
        {txt:"Practice makes perfect.", auth:"ç†Ÿèƒ½ç”Ÿå·§"}, {txt:"ä¸šç²¾äºå‹¤ï¼Œè’äºå¬‰ã€‚", auth:"éŸ©æ„ˆ"},
        {txt:"è¯»ä¹¦ç ´ä¸‡å·ï¼Œä¸‹ç¬”å¦‚æœ‰ç¥ã€‚", auth:"æœç”«"}, {txt:"Where there is a will, there is a way.", auth:"æœ‰å¿—è€…äº‹ç«Ÿæˆ"},
        {txt:"å°‘å£®ä¸åŠªåŠ›ï¼Œè€å¤§å¾’ä¼¤æ‚²ã€‚", auth:"æ±‰ä¹åºœ"}, {txt:"å­¦è€Œä¸æ€åˆ™ç½”ï¼Œæ€è€Œä¸å­¦åˆ™æ®†ã€‚", auth:"å­”å­"},
        {txt:"åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹ã€‚", auth:"è€å­"}, {txt:"No pain, no gain.", auth:"ä¸€åˆ†è€•è€˜"},
        {txt:"ä¸‰äººè¡Œï¼Œå¿…æœ‰æˆ‘å¸ˆç„‰ã€‚", auth:"å­”å­"}, {txt:"å®å‰‘é”‹ä»ç£¨ç ºå‡ºï¼Œæ¢…èŠ±é¦™è‡ªè‹¦å¯’æ¥ã€‚", auth:"è­¦ä¸–è´¤æ–‡"},
        {txt:"Time is money.", auth:"æ—¶é—´å°±æ˜¯é‡‘é’±"}, {txt:"çŸ¥ä¹‹ä¸ºçŸ¥ä¹‹ï¼Œä¸çŸ¥ä¸ºä¸çŸ¥ã€‚", auth:"å­”å­"},
        {txt:"å¤©è¡Œå¥ï¼Œå›å­ä»¥è‡ªå¼ºä¸æ¯ã€‚", auth:"æ˜“ç»"}, {txt:"Failures are the pillars of success.", auth:"å¤±è´¥æ˜¯æˆåŠŸä¹‹æ¯"},
        {txt:"æ¬²ç©·åƒé‡Œç›®ï¼Œæ›´ä¸Šä¸€å±‚æ¥¼ã€‚", auth:"ç‹ä¹‹æ¶£"}, {txt:"è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢ã€‚", auth:"å±ˆåŸ"},
        {txt:"Knowledge is power.", auth:"çŸ¥è¯†å°±æ˜¯åŠ›é‡"}, {txt:"çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œã€‚", auth:"é™†æ¸¸"},
        {txt:"ä¸€å¯¸å…‰é˜´ä¸€å¯¸é‡‘ã€‚", auth:"ç‹è´ç™½"}, {txt:"Better late than never.", auth:"äº¡ç¾Šè¡¥ç‰¢"},
        {txt:"é»‘å‘ä¸çŸ¥å‹¤å­¦æ—©ï¼Œç™½é¦–æ–¹æ‚”è¯»ä¹¦è¿Ÿã€‚", auth:"é¢œçœŸå¿"}, {txt:"ç‰ä¸ç¢ï¼Œä¸æˆå™¨ã€‚", auth:"ä¸‰å­—ç»"},
        {txt:"Honesty is the best policy.", auth:"è¯šå®æ˜¯ä¸Šç­–"}, {txt:"å‹¿ä»¥æ¶å°è€Œä¸ºä¹‹ã€‚", auth:"åˆ˜å¤‡"},
        {txt:"æ•è€Œå¥½å­¦ï¼Œä¸è€»ä¸‹é—®ã€‚", auth:"å­”å­"}, {txt:"Actions speak louder than words.", auth:"è¡Œèƒœäºè¨€"},
        {txt:"ä¹¦å±±æœ‰è·¯å‹¤ä¸ºå¾„ã€‚", auth:"éŸ©æ„ˆ"}, {txt:"åšå­¦ä¹‹ï¼Œå®¡é—®ä¹‹ã€‚", auth:"ä¸­åº¸"}, {txt:"Stay hungry.", auth:"ä¹”å¸ƒæ–¯"}
    ];

    const DEFAULT_EXAMS = [
        { date: '10-08', ch: 85, ma: 90, en: 88, comment: "å¼€å­¦è€ƒ" },
        { date: '11-05', ch: 92, ma: 92, en: 94, comment: "æœŸä¸­è€ƒ" }
    ];

    const DEFAULT_SCHEDULE = [
        {time:'08:00', data:['è¯­æ–‡','æ•°å­¦','è¯­æ–‡','è‹±è¯­','è¯­æ–‡']},
        {time:'09:00', data:['æ•°å­¦','è¯­æ–‡','ç§‘å­¦','æ•°å­¦','æ•°å­¦']},
        {time:'10:00', data:['è‹±è¯­','ç¾æœ¯','ä½“è‚²','è¯­æ–‡','è‹±è¯­']},
        {time:'14:00', data:['ä½“è‚²','é“æ³•','ç¤¾å›¢','ä¿¡æ¯','ç­ä¼š']},
        {time:'15:00', data:['è‡ªä¹ ','è‡ªä¹ ','é˜…è¯»','å†™å­—','åŠ³åŠ¨']}
    ];

    const DEFAULT_HABITS = [
        {id:1, type:'study', txt:'å®Œæˆå­¦æ ¡ä½œä¸š'}, {id:2, type:'study', txt:'é˜…è¯»20åˆ†é’Ÿ'},
        {id:4, type:'life', txt:'æŒ‰æ—¶èµ·åºŠ'}, {id:6, type:'life', txt:'åšä¸€ä»¶å®¶åŠ¡'}
    ];

    const DEFAULT_REWARDS = [
        {name:'çœ‹ç”µè§†(1é›†)', cost:50, icon:'ğŸ“º'}, {name:'ç©æ¸¸æˆ(20åˆ†)', cost:80, icon:'ğŸ“±'},
        {name:'å†°æ·‡æ·‹', cost:120, icon:'ğŸ¦'}, {name:'ç›²ç›’', cost:300, icon:'ğŸ§¸'}
    ];

    const KNOWLEDGE_DATA = {
        chinese: ["1. å¤§é’æ ‘ä¸‹çš„å°å­¦", "2. èŠ±çš„å­¦æ ¡", "3. ä¸æ‡‚å°±è¦é—®", "å¤è¯—ï¼šå±±è¡Œ", "å¤è¯—ï¼šèµ åˆ˜æ™¯æ–‡", "å¤è¯—ï¼šå¤œä¹¦æ‰€è§", "6. ç§‹å¤©çš„é›¨", "18. å¯Œé¥¶çš„è¥¿æ²™ç¾¤å²›", "24. å¸é©¬å…‰"],
        math: ["1. æ—¶åˆ†ç§’", "2. ä¸‡ä»¥å†…åŠ å‡", "3. æµ‹é‡", "5. å€çš„è®¤è¯†", "6. å¤šä½æ•°ä¹˜ä¸€ä½æ•°", "7. é•¿æ–¹å½¢å’Œæ­£æ–¹å½¢", "8. åˆ†æ•°åˆæ­¥è®¤è¯†"],
        english: ["Unit 1 Hello!", "Unit 2 Colours", "Unit 3 Look at me!", "Unit 4 We love animals", "Unit 5 Let's eat!", "Unit 6 Happy birthday!"]
    };

    // ================= æ ¸å¿ƒåº”ç”¨çŠ¶æ€ =================
    let app = {
        points: 0,
        startDate: new Date().getTime(),
        exams: JSON.parse(JSON.stringify(DEFAULT_EXAMS)),
        schedule: JSON.parse(JSON.stringify(DEFAULT_SCHEDULE)),
        habits: JSON.parse(JSON.stringify(DEFAULT_HABITS)),
        rewards: JSON.parse(JSON.stringify(DEFAULT_REWARDS)),
        extraQuotes: [],
        kStatus: {},
        habitStats: { total: 0, today: {} } 
    };
    
    // å­¦æœŸæ—¶é—´
    const SEMESTER_START = new Date("2024-09-01").getTime();
    const SEMESTER_END = new Date("2025-01-20").getTime();
    
    let myChart = null;
    let timerInterval = null;

    window.onload = function() {
        const save = localStorage.getItem('panda_v16_admin');
        if(save) app = { ...app, ...JSON.parse(save) };

        renderBaseInfo();
        loadDailyQuote();
        renderSchedule();
        renderSemesterProgress();
        initChartAndStats();
        renderKnowledge();
        renderHabits();
        renderRewards();
    };

    function saveData() {
        localStorage.setItem('panda_v16_admin', JSON.stringify(app));
        renderBaseInfo();
    }
    function renderBaseInfo() {
        document.getElementById('stat-points').innerText = app.points;
        const diff = Math.ceil((new Date().getTime() - app.startDate) / 86400000);
        document.getElementById('stat-days').innerText = diff || 1;
        document.getElementById('today-date').innerText = new Date().toLocaleDateString();
    }

    // --- 1. å­¦æœŸè¿›åº¦ ---
    function renderSemesterProgress() {
        const now = new Date().getTime();
        const total = SEMESTER_END - SEMESTER_START;
        let elapsed = now - SEMESTER_START;
        if (elapsed < 0) elapsed = 0; if (elapsed > total) elapsed = total;
        const percent = Math.round((elapsed / total) * 100);
        const daysLeft = Math.ceil((SEMESTER_END - now) / 86400000);
        document.getElementById('semester-bar').style.width = percent + '%';
        document.getElementById('semester-percent').innerText = percent + '%';
        document.getElementById('days-left').innerText = daysLeft > 0 ? daysLeft : 0;
    }

    // --- 2. è¯¾è¡¨ ---
    function renderSchedule() {
        const tbody = document.querySelector('#sch-table tbody');
        const day = new Date().getDay(); 
        const weekEn = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
        const nextDay = (day===5||day===6) ? 1 : day+1;
        document.getElementById('tomorrow-day').innerText = weekEn[nextDay]; 

        let html = '';
        app.schedule.forEach(row => {
            html += `<tr><td class="en-font">${row.time}</td>`;
            row.data.forEach((sub, idx) => {
                const isToday = (idx+1) === day;
                html += `<td class="${isToday?'today-col':''} ${sub==='è‹±è¯­'?'en-font':''}">${sub}</td>`;
            });
            html += `</tr>`;
        });
        tbody.innerHTML = html;
        
        const nextSub = app.schedule.map(r => r.data[nextDay-1]);
        const packDiv = document.getElementById('pack-list');
        let items = new Set();
        if(nextSub.includes('è¯­æ–‡')) items.add('è¯­æ–‡ä¹¦'); if(nextSub.includes('æ•°å­¦')) items.add('æ•°å­¦ä¹¦'); if(nextSub.includes('è‹±è¯­')) items.add('English Book');
        let phtml = ''; items.forEach(i => phtml += `<span style="background:rgba(255,255,255,0.2); padding:5px 10px; border-radius:4px; font-size:12px; margin-right:5px;">${i}</span>`);
        packDiv.innerHTML = phtml || "æ— éœ€ç‰¹æ®Šå‡†å¤‡";
    }

    // --- 3. ä¹ æƒ¯æ‰“å¡ ---
    function renderHabits() {
        const todayKey = new Date().toDateString(); 
        if(!app.habitStats.today[todayKey]) app.habitStats.today[todayKey] = [];
        const todayDoneIds = app.habitStats.today[todayKey];

        const fill = (type, elId) => {
            let html = '';
            app.habits.filter(h => h.type === type).forEach(h => {
                const isDone = todayDoneIds.includes(h.id);
                html += `<div class="habit-item ${isDone?'done':''}" onclick="toggleHabit(${h.id}, '${todayKey}')">
                    <div><b>${h.txt}</b></div><div class="habit-check">${isDone?'âœ”':''}</div>
                </div>`;
            });
            document.getElementById(elId).innerHTML = html;
        };
        fill('study', 'habit-list-study'); fill('life', 'habit-list-life');
        document.getElementById('habit-total-count').innerText = app.habitStats.total;
        document.getElementById('habit-today-count').innerText = `${todayDoneIds.length} / ${app.habits.length}`;
    }

    function toggleHabit(id, todayKey) {
        const list = app.habitStats.today[todayKey];
        const idx = list.indexOf(id);
        if(idx > -1) { // æ’¤é”€
            list.splice(idx, 1); app.habitStats.total--; app.points -= 5;
        } else { // æ‰“å¡
            list.push(id); app.habitStats.total++; app.points += 5;
        }
        saveData(); renderHabits();
    }

    // --- 4. å¥–åŠ± ---
    function renderRewards() {
        const div = document.getElementById('reward-list');
        let html = '';
        app.rewards.forEach((r, idx) => {
            html += `<div class="reward-card" onclick="redeemReward(${idx})">
                <div class="reward-icon">${r.icon}</div>
                <div class="en-font"><b>${r.name}</b></div>
                <div style="color:#b83b3b">${r.cost} ç§¯åˆ†</div>
            </div>`;
        });
        div.innerHTML = html;
    }
    function redeemReward(idx) {
        const r = app.rewards[idx];
        if(app.points >= r.cost) {
            if(confirm(`ç¡®å®šæ¶ˆè€— ${r.cost} ç§¯åˆ†å…‘æ¢ [${r.name}] å—ï¼Ÿ`)) {
                app.points -= r.cost; saveData(); alert("å…‘æ¢æˆåŠŸï¼");
            }
        } else {
            alert("ç§¯åˆ†ä¸è¶³ï¼");
        }
    }

    // --- å…¶ä»–æ¸²æŸ“å‡½æ•° (æˆç»©ã€çŸ¥è¯†æ ‘ã€åè¨€) ---
    function loadDailyQuote() {
        const day = new Date().getDate(); 
        let q = (app.extraQuotes.length > 0) ? app.extraQuotes[app.extraQuotes.length-1] : DEFAULT_QUOTES[day > 30 ? 1 : day];
        const txtEl = document.getElementById('daily-quote-text');
        txtEl.innerText = q.txt; txtEl.className = /[a-zA-Z]/.test(q.txt) ? "quote-text en-font" : "quote-text";
        document.getElementById('daily-quote-author').innerText = "â€”â€” " + q.auth;
    }
    function renderKnowledge() {
        let total = 0, done = 0;
        ['chinese', 'math', 'english'].forEach(sub => {
            const div = document.getElementById('k-list-'+sub);
            let html = `<div style="font-weight:bold;margin-bottom:10px;color:${sub=='chinese'?'#b83b3b':(sub=='math'?'#2980b9':'#27ae60')}">${sub=='chinese'?'ğŸ“– è¯­æ–‡':(sub=='math'?'ğŸ“ æ•°å­¦':'ğŸ”¤ è‹±è¯­')}</div>`;
            KNOWLEDGE_DATA[sub].forEach((item, idx) => {
                total++; const key = `${sub}-${idx}`; const isDone = app.kStatus[key]; if(isDone) done++;
                html += `<div class="k-item ${isDone?'completed':''}" onclick="toggleK('${key}')"><span>${item}</span><span>${isDone?'âœ…':'âšª'}</span></div>`;
            });
            div.innerHTML = html;
        });
        const pct = total===0?0:Math.round((done/total)*100);
        document.getElementById('k-progress-bar').style.width = pct+'%'; document.getElementById('k-progress-text').innerText = pct+'%';
    }
    function toggleK(k) { app.kStatus[k]=!app.kStatus[k]; if(app.kStatus[k]) app.points+=2; else app.points-=2; saveData(); renderKnowledge(); }
    function initChartAndStats() {
        const ctx = document.getElementById('scoreChart').getContext('2d');
        const labels = app.exams.map(d => d.date);
        Chart.defaults.font.family = "'Comic Sans MS', 'Kaiti'";
        if(myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'line', data: { labels: labels, datasets: [
                {label:'è¯­æ–‡',data:app.exams.map(d=>d.ch),borderColor:'#b83b3b',tension:0.3},
                {label:'æ•°å­¦',data:app.exams.map(d=>d.ma),borderColor:'#2980b9',tension:0.3},
                {label:'è‹±è¯­',data:app.exams.map(d=>d.en),borderColor:'#27ae60',tension:0.3}
            ]}, options:{responsive:true,maintainAspectRatio:false,scales:{y:{min:60,max:100}}}
        });
        let cardsHtml = '';
        [{k:'ch',n:'è¯­æ–‡',c:'#b83b3b'},{k:'ma',n:'æ•°å­¦',c:'#2980b9'},{k:'en',n:'è‹±è¯­',c:'#27ae60'}].forEach(s => {
            const sc = app.exams.map(e=>parseInt(e[s.k])); const now=sc[sc.length-1]||0; const pre=sc.length>1?sc[sc.length-2]:now; const d=now-pre;
            let th = d>0?`<span class="trend-down">â–²+${d}</span>`:(d<0?`<span class="trend-up">â–¼${d}</span>`:'-');
            cardsHtml+=`<div class="stat-card" style="border-top:4px solid ${s.c}"><h4 style="color:${s.c}">${s.n}</h4><div class="stat-score">${now}</div><div class="stat-trend">${th}</div></div>`;
        });
        document.getElementById('subject-stats-cards').innerHTML = cardsHtml;
        let thtml = ''; [...app.exams].reverse().forEach(r=>{ thtml+=`<tr><td class="en-font">${r.date}</td><td><span style="color:#b83b3b">è¯­${r.ch}</span>/<span style="color:#2980b9">æ•°${r.ma}</span>/<span style="color:#27ae60">å¤–${r.en}</span></td><td class="en-font"><b>${Math.round((parseInt(r.ch)+parseInt(r.ma)+parseInt(r.en))/3)}</b></td><td style="font-size:12px">${r.comment}</td></tr>`; });
        document.getElementById('score-table-body').innerHTML = thtml;
    }

    // --- åå°é€»è¾‘ ---
    function checkAdmin() { if(prompt("è¯·è¾“å…¥å¯†ç  (8888):")==="8888") switchPage('admin',null); }
    function logoutAdmin() { switchPage('schedule', document.querySelector('.nav-item')); }
    function toggleAdminSection(el) { el.parentElement.classList.toggle('open'); if(el.parentElement.classList.contains('open')) { renderAdminSchedule(); renderAdminHabits(); renderAdminRewards(); } }

    function renderAdminSchedule() {
        const tbody = document.querySelector('#admin-schedule-table tbody');
        let html = '';
        app.schedule.forEach((row, rIdx) => {
            html += `<tr><td><input value="${row.time}" onchange="app.schedule[${rIdx}].time=this.value"></td>`;
            row.data.forEach((cell, cIdx) => {
                html += `<td><input value="${cell}" onchange="app.schedule[${rIdx}].data[${cIdx}]=this.value"></td>`;
            });
            html += `</tr>`;
        });
        tbody.innerHTML = html;
    }
    function saveScheduleAdmin() { saveData(); renderSchedule(); alert('è¯¾è¡¨å·²æ›´æ–°'); }
    
    function renderAdminHabits() {
        const ul = document.getElementById('admin-habit-list');
        ul.innerHTML = app.habits.map((h, i) => `<li>[${h.type=='study'?'å­¦ä¹ ':'ç”Ÿæ´»'}] ${h.txt} <button class="btn-del" onclick="app.habits.splice(${i},1);saveData();renderAdminHabits();renderHabits();">åˆ </button></li>`).join('');
    }
    function addHabitAdmin() {
        const txt=document.getElementById('new-habit-txt').value; const type=document.getElementById('new-habit-type').value;
        if(txt){ app.habits.push({id:Date.now(), type, txt}); saveData(); renderAdminHabits(); renderHabits(); document.getElementById('new-habit-txt').value=''; }
    }

    function renderAdminRewards() {
        const ul = document.getElementById('admin-reward-list');
        ul.innerHTML = app.rewards.map((r, i) => `<li>${r.icon} ${r.name} (${r.cost}) <button class="btn-del" onclick="app.rewards.splice(${i},1);saveData();renderAdminRewards();renderRewards();">åˆ </button></li>`).join('');
    }
    function addRewardAdmin() {
        const name=document.getElementById('new-reward-name').value; const cost=document.getElementById('new-reward-cost').value; const icon=document.getElementById('new-reward-icon').value;
        if(name&&cost){ app.rewards.push({name, cost:parseInt(cost), icon:icon||'ğŸ'}); saveData(); renderAdminRewards(); renderRewards(); }
    }
    function adminAddExam() {
        const date=document.getElementById('admin-date').value; const ch=document.getElementById('admin-ch').value;
        const ma=document.getElementById('admin-ma').value; const en=document.getElementById('admin-en').value;
        if(date&&ch) { app.exams.push({date, ch, ma, en, comment:document.getElementById('admin-comment').value||'æ–°å½•å…¥'}); saveData(); initChartAndStats(); alert('å½•å…¥æˆåŠŸ'); }
    }

    function startTimer(m) { clearInterval(timerInterval); let s=m*60; document.getElementById('timer-display').innerText=`${m}:00`; timerInterval=setInterval(()=>{s--;const mi=Math.floor(s/60).toString().padStart(2,'0');const se=(s%60).toString().padStart(2,'0');document.getElementById('timer-display').innerText=`${mi}:${se}`;if(s<=0){clearInterval(timerInterval);alert('æ—¶é—´åˆ°');app.points+=5;saveData();}},1000); }
    function resetTimer() { clearInterval(timerInterval); document.getElementById('timer-display').innerText="25:00"; }
    function switchPage(pid,btn) { document.querySelectorAll('.page').forEach(p=>{p.classList.remove('active');p.style.display='none'}); const t=document.getElementById('page-'+pid); if(t){t.style.display='block';setTimeout(()=>t.classList.add('active'),10);} if(btn){document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));btn.classList.add('active');}}

</script>
</body>
</html>
